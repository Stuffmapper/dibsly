
var controllers = angular.module('controllers');


controllers.controller('MyStuffCtrl', ['$scope', 'MarkerService',
'UserService',function ($scope, MarkerService, UserService){
  $scope.UserService = UserService;
  $scope.MarkerService = MarkerService;
  $scope.$watchCollection('UserService', function() {
    $scope.currentUser = UserService.currentUser;
  });
  $scope.$watchCollection('MarkerService', function(){
    $scope.dibs = $scope.show('dibber');
    $scope.posts = $scope.show('creator');
  });

  $scope.tabs = {
    myPosts: true,
    myDibs: false,
    myMessages: false,
    myProfile: false };

    $scope.showtab = function(tab){
      angular.forEach($scope.tabs, function(value, key){
        if(key == tab){
          $scope.tabs[key] = true;
        } else { $scope.tabs[key] = false }
      });
    };
    $scope.show = function(userStatus){
      var results = [];
      if($scope.currentUser){
        var check = {};
        check[userStatus] = $scope.currentUser;
        results = MarkerService.where(check)
      }
      angular.forEach(results, function(marker){
        if(marker.marker){
          marker.marker.setIcon(MarkerService.icons[userStatus]);
        }
      })
      return results;
    };



}]);
