
var controllers = angular.module('controllers');


controllers.controller('MyStuffCtrl', ['$scope', 'MarkerService',
'UserService',function ($scope, MarkerService, UserService){

  // $scope.$watchCollection('UserService', function() {
  //   $scope.currentUser = UserService.currentUser;
  // });
  $scope.$watchCollection('MarkerService', function(){
    $scope.markers = MarkerService.markers;
    $scope.dibs = $scope.show('dibber');
    $scope.posts = $scope.show('creator');
  });

  $scope.tabs = {
    myPosts: true,
    myDibs: false,
    myMessages: false,
    myProfile: false };

    $scope.showtab = function(tab){
      angular.forEach($scope.tabs, function(value, key){
        if(key == tab){
          $scope.tabs[key] = true;
        } else { $scope.tabs[key] = false }
      });
    };
    $scope.show = function(userStatus){
      var results = [];
      if($scope.currentUser){
        angular.forEach( MarkerService.markers, function(value, key){
          if(value[userStatus] === $scope.currentUser ){
            results.push(value);
            if(value.marker){
              value.marker.setIcon(MarkerService.icons[userStatus])
            }
          }
        });
      }
      return results.sort(function(a, b){
        if(a.updated_at > b.updated_at){
          return -1;
        } else if(a.updated_at < b.updated_at){
          return 1;
        } else { return 0;}
      });
    };


}]);
