
<div ng-controller='StuffCtrl'>
  <div class="container overlap"  >
      <button class="btn" ng-click="togglemap('40%')" ng-show='fullMap' id="show-stuffmapper-menu">Show Menu</button>


    	<div class="col-md-4 col-md-offset-8" id="stuffmapper-menu" ng-hide="fullMap">

          <button  id="hide-stuffmapper-menu" ng-hide="fullMap" ng-click="togglemap('100%')" >>></button>

      <alerts></alerts>


      <div class="stuff-tab-container" >

        <tabset >



        <tab heading="Get Stuff"  active='true' ng-click='getStuff()'  >
           <div id="get-stuff" >
              <div class="row col-md-12 row">
                 <button class="btn" ng-click="onTheCurb()" ng-hide="curb_only"> Only on the Curb</button>
                 <button class="btn" ng-click="onTheCurb()" ng-show="curb_only"> Only not on the Curb</button>

              </div>

              <div ng-repeat="item in markers" >
                <div class="stuff-view col-lg-6 col-md-6 col-xs-6 " title={{item.description}} ng-attr-id={{item.id + '-stuff'}} ng-hide=viewing >
                  <div class= "stuff-image-container clearfix">
                    <img class="stuff-image img-responsive" ng-src={{item.image_url}}
                    ng-click='markerWindow(item.id)'></img>
                  </div>
                  <div class="col-md-12">
                    <dib post="item.id"></dib>
                    <button class= "btn-xs btn-default"
                    ng-click=markerWindow(item.id)
                    >Details</button>
                  </div>
                </div>
                  <details post="item.id" stuff="item" markers="markers"
                   viewing=item.viewing ng-show=item.viewing></details>
              </div>

           </div>
        </tab>


         <tab heading="Give Stuff" ng-click="startMapper()">
            <div id="give-stuff">
              <div ng-hide='currentUser' >
                Please <a class='btn' ng-click="showSignin()" >sign in</a> to give stuff

              </div>

              <div ng-hide="loading || !currentUser" >
                <p ng-hide='file'> Take a picture of the stuff that you want to give </p>
                <p ng-show='file'> Now enter some details, check the location on the map and press the "Give this Stuff!" button </p>
                <form id="give-stuff-form">
                <div class="col-lg-12 col-md-12 col-xs-12">
                  <div class="form-group col-md-6">

                    <div id="give-stuff-file-container" class='btn'>

                      <span class="glyphicon glyphicon-camera" aria-hidden="true"></span>

                       <input type="file" id="give-stuff-file" file-upload accept="image/*" capture>


                    </div>
                  </div>

                  <div class="col-md-6" id="upload-file-names" >
                    <canvas id="sm-thumbnail" ></canvas>
                  </div>

                </div>


                <div class="form-group col-md-12 row">

                  <select class="form-control" id="category" placeholder="Category" ng-model="post.category" >
                    <option>Electronics</option>
                    <option>Craft Materials</option>
                    <option>Kitchen</option>
                    <option>Garden&Nature</option>
                    <option>Toys</option>
                    <option>Furniture</option>
                    <option>Building Materials</option>
                    <option>Misc</option>
                  </select>

                </div>

                <div class="form-group col-md-12 row">
                  <input type="text" class="form-control" id="description" placeholder="Describe this stuff (you can use #tags)" ng-model="post.description">
                </div>

                <div class="checkbox col-md-12 row">
                  <label><input type="checkbox" id="on_the_curb" name="on_the_curb" ng-model="post.on_the_curb" value='' >This item is on the curb/outside/unattended by me. </label>
                </div>

                <div class="form-group col-md-12 row">
                    <button class="btn" id="give-stuff-submit" ng-click="submitPost()">Give this stuff!</button>
                </div>
              </form>
            </div>

            <div ng-show="loading" class="add-margin-top-50 col-lg-4 col-lg-offset-4 col-md-4 col-md-offset-4 col-xs-4 col-xs-offset-4">
              <img class="img-responsive" ng-src=<%= asset_path('spinner.gif')%> ></img>
            </div>
          </div>
        </tab>

         <tab heading="My Stuff"  ng-click="getMyStuff()" >
            <div id="my-stuff" >
              <div ng-hide='currentUser' >
                Please
                <a class='btn'
                ng-click="showSignin()" >sign in</a>to view your stuff
              </div>
                <details post="currentPost.id"
                stuff="currentPost" markers="markers"
                 viewing="currentPost.viewing"
                 ng-show="currentPost.viewing"  ></details>

                <edit post="currentPost.id" stuff="currentPost"
                 markers="markers" editing='currentPost.editing'
                 ng-show='currentPost.editing'></edit>

              <hr>
              <h4> My Posts </h4>

              <div ng-repeat="post in mystuff.posts track by $index"
              id="mystuff-{{post.id}}"
              ng-hide="post == undefined || !currentUser" >
               <div class ='col-lg-12 col-md-12 col-xs-12'>
                  <div class="stuff-view col-lg-3 col-md-3 col-xs-3"
                  title={{stuff.description}}  ng-hide=editing  >

                      <div class= "stuff-image-container" >

                        <img class="stuff-image img-responsive"
                        ng-src={{post.image_url}} ></img>
                      </div>

                  </div>

                  <div class='col-lg-9 col-md-9 col-xs-9'>
                       <undib post="post.id" mystuff="post"
                       ng-hide="currentUser == post.creator"></undib>
                       <button class= "btn-xs btn-default col-lg-4 col-md-4 col-xs-4"
                       ng-click='edit(post)'
                       ng-show="currentUser == post.creator">Edit</button>

                       <button class= "btn-xs btn-default col-lg-4 col-md-4 col-xs-4"
                       ng-click='viewDetails(post)'>Details</button>

                       <div class='col-lg-12 col-md-12 col-xs-12'
                        ng-hide='post.published'
                        >Unpublished</div>
                       <div class='col-lg-12 col-md-12 col-xs-12' ng-show='post.published'
                       >Published</div>
                    <ul ng-show='!post.dibbable'>
                      <li >
                        <p>Dibbed by: {{ post.currentDib.dibber}}<p>


                          <label for='undibReason'> Remove Current Dib </label>
                           <select class="form-control" id="undibReason"
                           placeholder="Select Reason" ng-model="undibReason" >
                            <option>missed pickup</option>
                            <option>dibber no longer wants item</option>
                            <option>dibber has flaked on previous pickup</option>
                            <option>other</option>
                          </select>

                          <button class= "btn-xs btn-default"
                          ng-click="removeDibber(post.currentDib.id, undibReason, post.id)"
                          >Remove</button>
                      </li>
                      <li>
                           <label for='goneReason'> Mark as Gone</label>
                           <select class="form-control"
                           id="goneReason" placeholder="Select Reason"
                           ng-model="goneReason" >
                            <option>dibber has picked up</option>
                            <option>item is no longer available</option>
                            <option>other</option>
                          </select>

                          <button class= "btn-xs btn-default"
                           ng-click="markGone(post.id, goneReason)">Update</button>
                      </li>

                    </ul>

                  </div>
                  <hr>


               </div >


              </div>

              <hr>
              <h4> My Dibs </h4>
                <div ng-repeat="dib in mystuff.dibs track by $index"
                 id="mystuff-{{dib.id}}" ng-hide="dib == undefined || !currentUser" >
               <div class ='col-lg-12 col-md-12 col-xs-12'>
                  <div class="stuff-view col-lg-3 col-md-3 col-xs-3"
                  title={{dib.description}}  ng-hide=editing  >

                      <div class= "stuff-image-container" >

                        <img class="stuff-image img-responsive"
                        ng-src={{dib.image_url}} ></img>
                      </div>

                  </div>

                  <div class='col-lg-9 col-md-9 col-xs-9'>
                       <undib post="dib.id" mystuff="dib"
                       ng-hide="currentUser == dib.creator"></undib>
                       <button class= "btn-xs btn-default"
                       ng-click='edit(dib)'
                       ng-show="currentUser == dib.creator">Edit</button>

                       <button class= "btn-xs btn-default"
                       ng-click='viewDetails(dib)'>Details</button>

                  </div>
                  <hr>


               </div >


              </div>
           </div>
         </tab>



      </tabset>
    </div>


  	</div>

  </div>

  <div class="container-fluid" id="map-container"  >



  <map id="google-map-container" center={{mapCenter}} zoom="12" >


  </map>

  </div>
</div>
