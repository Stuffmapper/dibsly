<div id="map-canvas" style="width: 100%; height: 100%; margin: 0px; top: 0px; left: 0px; overflow: hidden; z-index: 1; position: absolute; background-color: rgb(229, 227, 223);"></div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>
<script type="text/javascript">
function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(47.606163,-122.330818),
          zoom: 8
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        <% @posts.each do |post| %>
            <% if (post.latitude != nil) && (post.longitude != nil) %>
        var marker<%= post.id %> = new google.maps.Marker({
          position: new google.maps.LatLng(<%= post.latitude %>,<%= post.longitude %>),
          map: map,
          title: '<%= post.title %>'
        });
        google.maps.event.addListener(marker<%= post.id %>, 'click', function() {
                new google.maps.InfoWindow({
                        content: '<%= post.description %><br><%= post.dibbed_until %><br><%= link_to 'Dib', dib_post_path(post), method: :dib %>'
                }).open(map,marker<%= post.id %>);
        });

            <% end %>
        <% end %>
}

</script>

<div id="main-grid">
<%= paginate @posts %>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Image url</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Dibbed until</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @posts.each do |post| %>
      <tr>
        <td><%= post.title %></td>
        <td><%= post.description %></td>
        <td>
          <%= image_tag post.image.url(:medium) %>
        </td>
        <td><%= post.latitude %></td>
        <td><%= post.longitude %></td>
        <td><%= post.dibbed_until %></td>
        <td><%= link_to 'Show', post %></td>
        <td><%= link_to 'Edit', edit_post_path(post) %></td>
        <td><%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <td><%= link_to 'Dib', dib_post_path(post), method: :dib %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @posts %>
</div>
